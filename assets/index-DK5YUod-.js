import{r as m}from"./index-CBqU2yxZ.js";import{b as v,i as q,g as B}from"./event-imqIgfLG.js";import{b as j,C as K,n as I}from"./factory-DLpD49Xl.js";const U=e=>{const t=m.useRef(null);return t.current=e,t},V=1/60*1e3,G=typeof performance<"u"?()=>performance.now():()=>Date.now(),A=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(G()),V);function J(e){let t=[],r=[],n=0,o=!1,a=!1;const c=new WeakSet,f={schedule:(s,i=!1,u=!1)=>{const l=u&&o,x=l?t:r;return i&&c.add(s),x.indexOf(s)===-1&&(x.push(s),l&&o&&(n=t.length)),s},cancel:s=>{const i=r.indexOf(s);i!==-1&&r.splice(i,1),c.delete(s)},process:s=>{if(o){a=!0;return}if(o=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let i=0;i<n;i++){const u=t[i];u(s),c.has(u)&&(f.schedule(u),e())}o=!1,a&&(a=!1,f.process(s))}};return f}const Q=40;let F=!0,y=!1,M=!1;const g={delta:0,timestamp:0},P=["read","update","preRender","render","postRender"],E=P.reduce((e,t)=>(e[t]=J(()=>y=!0),e),{}),X=P.reduce((e,t)=>{const r=E[t];return e[t]=(n,o=!1,a=!1)=>(y||_(),r.schedule(n,o,a)),e},{}),Y=P.reduce((e,t)=>(e[t]=E[t].cancel,e),{});P.reduce((e,t)=>(e[t]=()=>E[t].process(g),e),{});const Z=e=>E[e].process(g),L=e=>{y=!1,g.delta=F?V:Math.max(Math.min(e-g.timestamp,Q),1),g.timestamp=e,M=!0,P.forEach(Z),M=!1,y&&(F=!1,A(L))},_=()=>{y=!0,F=!0,M||A(L)},C=()=>g,H=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),D=(e,t)=>({point:e.point,delta:H(e.point,t[t.length-1]),offset:H(e.point,t[0]),velocity:k(t,.1)}),$=e=>e*1e3,k=(e,t)=>{if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const o=e[e.length-1];for(;r>=0&&(n=e[r],!(o.timestamp-n.timestamp>$(t)));)r--;if(!n)return{x:0,y:0};const a=(o.timestamp-n.timestamp)/1e3;if(a===0)return{x:0,y:0};const c={x:(o.x-n.x)/a,y:(o.y-n.y)/a};return c.x===1/0&&(c.x=0),c.y===1/0&&(c.y=0),c},ee=(...e)=>t=>e.reduce((r,n)=>n(r),t),S=(e,t)=>Math.abs(e-t),O=e=>"x"in e&&"y"in e,te=(e,t)=>{if(typeof e=="number"&&typeof t=="number")return S(e,t);if(O(e)&&O(t)){const r=S(e.x,t.x),n=S(e.y,t.y);return Math.sqrt(r**2+n**2)}return 0},ne=(e,t,r=3)=>{if(q(e))return;const n=e.view??window,o={point:B(e)},{timestamp:a}=C(),{onSessionStart:c}=t,f=[{...o.point,timestamp:a}];let s=null,i=null,u=null;e.stopPropagation(),e.preventDefault(),c==null||c(e,D(o,f));const l=()=>{if(!(i&&u))return;const p=D(u,f),w=s!==null,b=te(p.offset,{x:0,y:0})>=r;if(!w&&!b)return;const{timestamp:h}=C();f.push({...p.point,timestamp:h});const{onStart:d,onMove:R}=t;w||(d==null||d(i,p),s=i),R==null||R(i,p)},x=(p,w)=>{i=p,u=w,X.update(l,!0)},T=(p,w)=>{const b=D(w,f),{onEnd:h,onSessionEnd:d}=t;d==null||d(p,b),N(),!(!h||!s)&&(h==null||h(p,b))},W=p=>{t=p};let z=ee(v(n,"pointermove",x),v(n,"pointerup",T),v(n,"pointercancel",T));const N=()=>{z==null||z(),Y.update(l)};return{updateHandlers:W,end:N}},ae=(e,{onMove:t,onStart:r,onEnd:n,onSessionStart:o,onSessionEnd:a,threshold:c})=>{const f=!!t||!!r||!!n||!!o||!!a,s=m.useRef(null),i=U({onSessionStart:o,onSessionEnd:a,onStart:r,onMove:t,onEnd:(u,l)=>{s.current=null,n==null||n(u,l)}});m.useEffect(()=>{var u;(u=s.current)==null||u.updateHandlers(i.current)}),m.useEffect(()=>{const u=e.current;return!u||!f?void 0:v(u,"pointerdown",x=>{s.current=ne(x,i.current,c)})},[e,f,i,c]),m.useEffect(()=>()=>{var u;(u=s.current)==null||u.end(),s.current=null},[])},se=(e,t)=>{if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const r=e.ownerDocument.defaultView??window,n=new r.ResizeObserver(o=>{if(!I(o)||!o.length)return;const[a]=o;let c,f;if("borderBoxSize"in a){const s=a.borderBoxSize,i=I(s)?s[0]:s;c=i.inlineSize,f=i.blockSize}else c=e.offsetWidth,f=e.offsetHeight;t({width:c,height:f})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)},re=(e,t)=>{var o;if(!e||!e.parentElement)return;const r=((o=e.ownerDocument)==null?void 0:o.defaultView)??window,n=new r.MutationObserver(()=>{t()});return n.observe(e.parentElement,{childList:!0}),()=>{n.disconnect()}},oe=({getNodes:e,observeMutation:t=!0})=>{const[r,n]=m.useState([]),[o,a]=m.useState(0);return j(()=>{const c=e(),f=c.map((s,i)=>se(s,u=>{n(l=>[...l.slice(0,i),u,...l.slice(i+1)])}));if(t){const s=c[0];f.push(re(s,()=>{a(i=>i+1)}))}return()=>{f.forEach(s=>{s==null||s()})}},[o]),r},fe=e=>{const[t]=oe({observeMutation:!1,getNodes:()=>[K(e)?e.current:e]});return t};export{fe as a,ae as b,oe as c,U as u};

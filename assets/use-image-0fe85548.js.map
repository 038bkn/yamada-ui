{"version":3,"file":"use-image-0fe85548.js","sources":["../../packages/components/image/src/use-image.ts"],"sourcesContent":["import { useSafeLayoutEffect } from \"@yamada-ui/utils\"\nimport {\n  ImgHTMLAttributes,\n  SyntheticEvent,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\ntype HTMLImageElementProps = ImgHTMLAttributes<HTMLImageElement>\n\nexport type UseImageProps = {\n  /**\n   * The image `src` attribute.\n   */\n  src?: string\n  /**\n   * The image `srcset` attribute.\n   */\n  srcSet?: string\n  /**\n   * The image `sizes` attribute.\n   */\n  sizes?: string\n  /**\n   * A callback for when the image `src` has been loaded.\n   */\n  onLoad?: HTMLImageElementProps[\"onLoad\"]\n  /**\n   * A callback for when there was an error loading the image `src`.\n   */\n  onError?: HTMLImageElementProps[\"onError\"]\n  /**\n   * If `true`, opt out of the `fallbackSrc` logic and use as `img`.\n   *\n   * @default false\n   */\n  ignoreFallback?: boolean\n  /**\n   * The key used to set the crossOrigin on the HTMLImageElement into which the image will be loaded.\n   * This tells the browser to request cross-origin access when trying to download the image data.\n   */\n  crossOrigin?: HTMLImageElementProps[\"crossOrigin\"]\n  /**\n   * The image `loading` attribute.\n   */\n  loading?: HTMLImageElementProps[\"loading\"]\n}\n\ntype Status = \"loading\" | \"failed\" | \"pending\" | \"loaded\"\n\nexport const shouldShowFallbackImage = (\n  status: Status,\n  fallbackStrategy: \"onError\" | \"beforeLoadOrError\",\n) =>\n  (status !== \"loaded\" && fallbackStrategy === \"beforeLoadOrError\") ||\n  (status === \"failed\" && fallbackStrategy === \"onError\")\n\nexport const useImage = ({\n  loading,\n  src,\n  srcSet,\n  onLoad,\n  onError,\n  crossOrigin,\n  sizes,\n  ignoreFallback,\n}: UseImageProps) => {\n  const [status, setStatus] = useState<Status>(\"pending\")\n\n  useEffect(() => {\n    setStatus(src ? \"loading\" : \"pending\")\n  }, [src])\n\n  const imageRef = useRef<HTMLImageElement | null>()\n\n  const load = useCallback(() => {\n    if (!src) return\n\n    flush()\n\n    const img = new Image()\n\n    img.src = src\n\n    if (crossOrigin) img.crossOrigin = crossOrigin\n    if (srcSet) img.srcset = srcSet\n    if (sizes) img.sizes = sizes\n    if (loading) img.loading = loading\n\n    img.onload = (ev) => {\n      flush()\n\n      setStatus(\"loaded\")\n\n      onLoad?.(ev as unknown as SyntheticEvent<HTMLImageElement, Event>)\n    }\n\n    img.onerror = (error) => {\n      flush()\n\n      setStatus(\"failed\")\n\n      onError?.(error as any)\n    }\n\n    imageRef.current = img\n  }, [src, crossOrigin, srcSet, sizes, onLoad, onError, loading])\n\n  const flush = () => {\n    if (!imageRef.current) return\n\n    imageRef.current.onload = null\n    imageRef.current.onerror = null\n    imageRef.current = null\n  }\n\n  useSafeLayoutEffect(() => {\n    if (ignoreFallback) return\n\n    if (status === \"loading\") load()\n\n    return () => {\n      flush()\n    }\n  }, [status, load, ignoreFallback])\n\n  return ignoreFallback ? \"loaded\" : status\n}\n\nexport type UseImageReturn = ReturnType<typeof useImage>\n"],"names":["shouldShowFallbackImage","status","fallbackStrategy","useImage","loading","src","srcSet","onLoad","onError","crossOrigin","sizes","ignoreFallback","setStatus","useState","useEffect","imageRef","useRef","load","useCallback","flush","img","ev","error","useSafeLayoutEffect"],"mappings":"kFAoDa,MAAAA,EAA0B,CACrCC,EACAC,IAECD,IAAW,UAAYC,IAAqB,qBAC5CD,IAAW,UAAYC,IAAqB,UAElCC,EAAW,CAAC,CACvB,QAAAC,EACA,IAAAC,EACA,OAAAC,EACA,OAAAC,EACA,QAAAC,EACA,YAAAC,EACA,MAAAC,EACA,eAAAC,CACF,IAAqB,CACnB,KAAM,CAACV,EAAQW,CAAS,EAAIC,WAAiB,SAAS,EAEtDC,EAAAA,UAAU,IAAM,CACJF,EAAAP,EAAM,UAAY,SAAS,CAAA,EACpC,CAACA,CAAG,CAAC,EAER,MAAMU,EAAWC,EAAAA,SAEXC,EAAOC,EAAAA,YAAY,IAAM,CAC7B,GAAI,CAACb,EAAK,OAEJc,IAEA,MAAAC,EAAM,IAAI,MAEhBA,EAAI,IAAMf,EAENI,IAAaW,EAAI,YAAcX,GAC/BH,IAAQc,EAAI,OAASd,GACrBI,IAAOU,EAAI,MAAQV,GACnBN,IAASgB,EAAI,QAAUhB,GAEvBgB,EAAA,OAAUC,GAAO,CACbF,IAENP,EAAU,QAAQ,EAElBL,GAAA,MAAAA,EAASc,EAAwD,EAG/DD,EAAA,QAAWE,GAAU,CACjBH,IAENP,EAAU,QAAQ,EAElBJ,GAAA,MAAAA,EAAUc,EAAY,EAGxBP,EAAS,QAAUK,CAAA,EAClB,CAACf,EAAKI,EAAaH,EAAQI,EAAOH,EAAQC,EAASJ,CAAO,CAAC,EAExDe,EAAQ,IAAM,CACbJ,EAAS,UAEdA,EAAS,QAAQ,OAAS,KAC1BA,EAAS,QAAQ,QAAU,KAC3BA,EAAS,QAAU,KAAA,EAGrB,OAAAQ,EAAoB,IAAM,CACpB,GAAA,CAAAZ,EAEJ,OAAIV,IAAW,WAAgBgB,IAExB,IAAM,CACLE,GAAA,CAEP,EAAA,CAAClB,EAAQgB,EAAMN,CAAc,CAAC,EAE1BA,EAAiB,SAAWV,CACrC"}
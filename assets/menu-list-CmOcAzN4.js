import{j as a}from"./jsx-runtime-X2b_N9AH.js";import{r as e}from"./index-uCp2LrAq.js";import{P as le,a as ie,b as fe}from"./popover-content-BuqQEBR6.js";import{c as me}from"./icon-i9DNsLAz.js";import{f as F}from"./forward-ref-Dr5Hqd9a.js";import{l as J,aa as $,h as Q,a as P,f as ee,u as S,c as U,y as de,ae as xe,ab as M,R as pe,e as Ce,d as be}from"./factory-DcjttzXA.js";import{c as Ie}from"./index-BqfSQEBY.js";import{u as he}from"./index-BBt5KR5O.js";import{u as we}from"./index-Chh_-GY8.js";import{a as Re}from"./use-component-style-Bt4oJcRH.js";import{o as je}from"./theme-provider-blvefFsb.js";const[_e,X]=J({strict:!1,name:"UpstreamMenuItemContext"}),ke=s=>{var r;return xe(s)&&!!((r=s==null?void 0:s.getAttribute("role"))!=null&&r.startsWith("menu-item"))},ye=F(({as:s,className:r,type:u,isDisabled:t,isFocusable:l,closeOnSelect:i,icon:d,command:b,children:c,onClick:C,onFocus:m,onMouseEnter:I,onMouseMove:h,onMouseLeave:R,onKeyDown:w,...n},_)=>{const{focusedIndex:x,setFocusedIndex:p,isOpen:q,onClose:k,onUpstreamClose:D,closeOnSelect:v,menuRef:N,requestAnimationFrameId:E,isNested:B,styles:H}=K(),{onUpstreamRestoreFocus:z}=X()??{},L=t&&!l,g=e.useRef(null),T=e.useRef(!1),y=e.useRef(()=>{}),{index:j,register:A}=Oe({disabled:L}),[f,O]=e.useState(!1),W=j===x,G=e.useCallback(o=>{I==null||I(o),!t&&p(j)},[p,j,t,I]),te=e.useCallback(o=>{h==null||h(o),g.current&&!$(g.current)&&G(o)},[G,h]),ne=e.useCallback(o=>{R==null||R(o),!t&&p(-1)},[p,t,R]),se=e.useCallback(o=>{if(C==null||C(o),!ke(o.currentTarget))return;const V=T.current;(i??(!V&&v))&&(k(),D==null||D())},[C,i,v,k,D]),oe=e.useCallback(o=>{m==null||m(o),p(j)},[m,p,j]),ae=e.useCallback(()=>{var o;(o=g.current)==null||o.focus(),p(j)},[p,j]),ce=e.useCallback(o=>{w==null||w(o);const Z={ArrowLeft:B?M(z,k):void 0}[o.key];Z&&(o.preventDefault(),o.stopPropagation(),Z())},[w,z,k,B]),re=we({focusOnClick:!1,...n,onClick:se,onFocus:oe,onMouseEnter:G,onMouseMove:te,onMouseLeave:ne,onKeyDown:Q(ce,y.current),ref:P(A,g,_),isDisabled:t,isFocusable:l});ee(()=>{if(!q)return;const o=E.current;return W&&!L&&g.current?(o&&cancelAnimationFrame(o),E.current=requestAnimationFrame(()=>{var V;(V=g.current)==null||V.focus({preventScroll:!0}),E.current=null})):N.current&&!$(N.current)&&N.current.focus({preventScroll:!0}),()=>{o&&cancelAnimationFrame(o)}},[W,L,N,q]),u=s||u?u??void 0:"button",c=d||b?a.jsx(S.span,{style:{flex:1},children:c}):c;const ue={textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,gap:"0.75rem",...H.item};return a.jsx(_e,{value:{onKeyDownRef:y,onUpstreamRestoreFocus:ae,setDownstreamOpen:O,hasDownstreamRef:T},children:a.jsxs(S.li,{...re,...f?{"data-active":""}:{},as:s,type:u,role:"menu-item",tabIndex:W?0:-1,className:U("ui-menu__item",r),__css:ue,children:[d?a.jsx(Y,{children:d}):null,c,b?a.jsx(De,{children:b}):null]})})}),Qe=F(({className:s,icon:r,isChecked:u,closeOnSelect:t=!1,children:l,...i},d)=>a.jsxs(ye,{ref:d,className:U("ui-menu__item--option",s),"aria-checked":de(u),closeOnSelect:t,...i,children:[r!==null?a.jsx(Y,{opacity:u?1:0,children:r||a.jsx(ge,{})}):null,l]})),Y=F(({className:s,...r},u)=>{const{styles:t}=K(),l={flexShrink:0,display:"inline-flex",justifyContent:"center",alignItems:"center",fontSize:"0.85em",...t.icon};return a.jsx(S.span,{ref:u,className:U("ui-menu__item__icon",s),__css:l,...r})}),De=F(({className:s,...r},u)=>{const{styles:t}=K(),l={...t.command};return a.jsx(S.span,{ref:u,className:U("ui-menu__item__command",s),__css:l,...r})}),ge=()=>a.jsx("svg",{viewBox:"0 0 14 14",width:"1em",height:"1em",children:a.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),{DescendantsContextProvider:Fe,useDescendantsContext:ve,useDescendants:Ae,useDescendant:Oe}=Ie(),[Me,K]=J({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Se,Ue]=J({strict:!1,name:"UpstreamMenuContext"}),Xe=s=>{const[r,u]=Re("Menu",s);let{initialFocusRef:t,closeOnSelect:l=!0,closeOnBlur:i,placement:d,duration:b=.2,offset:c,onOpen:C,onClose:m,...I}=je(u);const{relatedRef:h,onUpstreamClose:R,onDownstreamCloseMapRef:w}=Ue()??{},{setDownstreamOpen:n,hasDownstreamRef:_}=X()??{},x=!!h;x?(d??(d="right-start"),c??(c=[-8,8]),i??(i=!1)):d??(d="bottom-start");const p=Ae(),[q,k]=e.useState(-1),D=e.useRef(null),v=e.useRef(new Set([])),N=e.useRef(null),E=e.useRef(new Map),B=e.useCallback(()=>{requestAnimationFrame(()=>{var f;return(f=D.current)==null?void 0:f.focus({preventScroll:!1})})},[]),H=e.useCallback(()=>{const f=setTimeout(()=>{if(t)return;const O=p.enabledFirstValue();O&&k(O.index)});v.current.add(f)},[p,t]),z=e.useCallback(()=>{const f=setTimeout(()=>{if(t)return;const O=p.enabledLastValue();O&&k(O.index)});v.current.add(f)},[p,t]),L=e.useCallback(()=>{C==null||C(),x||B()},[C,x,B]),g=e.useCallback(()=>{m==null||m();for(const f of E.current.values())f()},[m]),T=e.useId(),{isOpen:y,onOpen:j,onClose:A}=he({...s,onOpen:L,onClose:g});return e.useEffect(()=>{const f=w==null?void 0:w.current;return f==null||f.set(T,A),()=>{f==null||f.delete(T)}},[T,A,w]),e.useEffect(()=>{n&&n(y)},[n,y]),e.useEffect(()=>(_&&(_.current=!0),()=>{_&&(_.current=!1)})),ee(()=>{y||k(-1)},[y]),pe(()=>{v.current.forEach(f=>clearTimeout(f)),v.current.clear()}),a.jsx(Fe,{value:p,children:a.jsx(Se,{value:{relatedRef:D,onDownstreamCloseMapRef:E,onUpstreamClose:M(R,A)},children:a.jsx(Me,{value:{isOpen:y,onOpen:j,onClose:A,onUpstreamClose:R,onFocusFirstItem:H,onFocusLastItem:z,closeOnSelect:l,focusedIndex:q,setFocusedIndex:k,menuRef:D,requestAnimationFrameId:N,isNested:x,styles:r},children:a.jsx(le,{trigger:x?"hover":"click",...I,isOpen:y,onOpen:j,onClose:A,placement:d,offset:c,duration:b,initialFocusRef:t,relatedRef:h,closeOnButton:!1,closeOnBlur:i})})})})},Ne=F(({className:s,children:r,as:u,...t},l)=>{const{onKeyDownRef:i,onUpstreamRestoreFocus:d}=X()??{},{isOpen:b,onOpen:c,onClose:C,onFocusFirstItem:m,onFocusLastItem:I}=K(),h=e.useCallback(n=>{const x={Enter:M(c,m),ArrowDown:M(c,m),ArrowUp:M(c,I)}[n.key];x&&(n.preventDefault(),x())},[m,I,c]),R=e.useCallback(n=>{const x={ArrowRight:b?void 0:M(c,m),ArrowLeft:b?M(d,C):void 0}[n.key];x&&(n.preventDefault(),x())},[b,c,m,d,C]);Ce(i,R);const w=u?S(u):Ee;return a.jsx(ie,{children:a.jsx(w,{ref:l,className:U("ui-menu",s),"aria-haspopup":"menu","aria-expanded":b,...t,"data-active":be(b),onKeyDown:Q(t.onKeyDown,h),children:r})})}),Ee=F((s,r)=>{const{styles:u}=K(),t={display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...u.button};return a.jsx(S.button,{ref:r,__css:t,...s})}),Ye=F(({className:s,children:r,innerProps:u,icon:t,iconProps:l,...i},d)=>a.jsxs(Ne,{ref:d,className:U("ui-menu__item-button",s),flex:"1",...i,children:[a.jsx(S.span,{as:"span",flex:"1",...u,children:r}),a.jsx(Y,{...l,children:t??a.jsx(me,{fontSize:"1.5em",transform:"rotate(-90deg)"})})]})),Ze=F(({className:s,...r},u)=>{const{menuRef:t,focusedIndex:l,setFocusedIndex:i,onClose:d,styles:b}=K(),c=ve(),C=e.useCallback(()=>{const n=c.enabledNextValue(l);n&&i(n.index)},[c,l,i]),m=e.useCallback(()=>{const n=c.enabledPrevValue(l);n&&i(n.index)},[c,l,i]),I=e.useCallback(()=>{const n=c.enabledFirstValue();n&&i(n.index)},[c,i]),h=e.useCallback(()=>{const n=c.enabledLastValue();n&&i(n.index)},[c,i]),R=e.useCallback(n=>{const x={Tab:p=>p.preventDefault(),Escape:d,ArrowDown:l===-1?I:C,ArrowUp:l===-1?h:m,Home:I,End:h}[n.key];x&&(n.preventDefault(),x(n))},[l,d,I,h,C,m]),w={...b.list};return a.jsx(fe,{as:"ul",ref:P(t,u),className:U("ui-menu__list",s),role:"menu",tabIndex:-1,__css:w,...r,onKeyDown:Q(r.onKeyDown,R)})});export{Xe as M,Ne as a,Ze as b,ye as c,Qe as d,Ye as e,K as u};

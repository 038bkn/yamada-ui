import{r as m}from"./index-76fb7be0.js";import{f as q,A as B}from"./factory-13baf058.js";const X=t=>{const e=j(t);return typeof e.PointerEvent<"u"&&t instanceof e.PointerEvent?t.pointerType==="mouse":t instanceof e.MouseEvent},H=t=>!!t.touches,Y=t=>H(t)&&t.touches.length>1,j=t=>t.view??window,K=(t,e="page")=>{const n=t.touches[0]||t.changedTouches[0];return{x:n[`${e}X`],y:n[`${e}Y`]}},U=(t,e="page")=>({x:t[`${e}X`],y:t[`${e}Y`]}),O=(t,e="page")=>H(t)?K(t,e):U(t,e),G=(t,e,n,s)=>(t.addEventListener(e,n,s),()=>{t.removeEventListener(e,n,s)}),J=t=>e=>{const n=X(e);(!n||n&&e.button===0)&&t(e)},Q=(t,e=!1)=>{const n=r=>t(r,{point:O(r)});return e?J(n):n},v=(t,e,n,s)=>G(t,e,Q(n,e==="pointerdown"),s),Z=t=>{const e=m.useRef(null);return e.current=t,e},V=1/60*1e3,_=typeof performance<"u"?()=>performance.now():()=>Date.now(),W=typeof window<"u"?t=>window.requestAnimationFrame(t):t=>setTimeout(()=>t(_()),V);function k(t){let e=[],n=[],s=0,r=!1,a=!1;const c=new WeakSet,f={schedule:(o,i=!1,u=!1)=>{const l=u&&r,h=l?e:n;return i&&c.add(o),h.indexOf(o)===-1&&(h.push(o),l&&r&&(s=e.length)),o},cancel:o=>{const i=n.indexOf(o);i!==-1&&n.splice(i,1),c.delete(o)},process:o=>{if(r){a=!0;return}if(r=!0,[e,n]=[n,e],n.length=0,s=e.length,s)for(let i=0;i<s;i++){const u=e[i];u(o),c.has(u)&&(f.schedule(u),t())}r=!1,a&&(a=!1,f.process(o))}};return f}const tt=40;let S=!0,y=!1,T=!1;const g={delta:0,timestamp:0},E=["read","update","preRender","render","postRender"],b=E.reduce((t,e)=>(t[e]=k(()=>y=!0),t),{}),et=E.reduce((t,e)=>{const n=b[e];return t[e]=(s,r=!1,a=!1)=>(y||ot(),n.schedule(s,r,a)),t},{}),nt=E.reduce((t,e)=>(t[e]=b[e].cancel,t),{});E.reduce((t,e)=>(t[e]=()=>b[e].process(g),t),{});const st=t=>b[t].process(g),$=t=>{y=!1,g.delta=S?V:Math.max(Math.min(t-g.timestamp,tt),1),g.timestamp=t,T=!0,E.forEach(st),T=!1,y&&(S=!1,W($))},ot=()=>{y=!0,S=!0,T||W($)},N=()=>g,I=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),M=(t,e)=>({point:t.point,delta:I(t.point,e[e.length-1]),offset:I(t.point,e[0]),velocity:it(e,.1)}),rt=t=>t*1e3,it=(t,e)=>{if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const r=t[t.length-1];for(;n>=0&&(s=t[n],!(r.timestamp-s.timestamp>rt(e)));)n--;if(!s)return{x:0,y:0};const a=(r.timestamp-s.timestamp)/1e3;if(a===0)return{x:0,y:0};const c={x:(r.x-s.x)/a,y:(r.y-s.y)/a};return c.x===1/0&&(c.x=0),c.y===1/0&&(c.y=0),c},ct=(...t)=>e=>t.reduce((n,s)=>s(n),e),R=(t,e)=>Math.abs(t-e),L=t=>"x"in t&&"y"in t,ut=(t,e)=>{if(typeof t=="number"&&typeof e=="number")return R(t,e);if(L(t)&&L(e)){const n=R(t.x,e.x),s=R(t.y,e.y);return Math.sqrt(n**2+s**2)}return 0},at=(t,e,n=3)=>{if(Y(t))return;const s=t.view??window,r={point:O(t)},{timestamp:a}=N(),{onSessionStart:c}=e,f=[{...r.point,timestamp:a}];let o=null,i=null,u=null;t.stopPropagation(),t.preventDefault(),c==null||c(t,M(r,f));const l=()=>{if(!(i&&u))return;const p=M(u,f),w=o!==null,P=ut(p.offset,{x:0,y:0})>=n;if(!w&&!P)return;const{timestamp:x}=N();f.push({...p.point,timestamp:x});const{onStart:d,onMove:D}=e;w||(d==null||d(i,p),o=i),D==null||D(i,p)},h=(p,w)=>{i=p,u=w,et.update(l,!0)},F=(p,w)=>{const P=M(w,f),{onEnd:x,onSessionEnd:d}=e;d==null||d(p,P),A(),!(!x||!o)&&(x==null||x(p,P))},C=p=>{e=p};let z=ct(v(s,"pointermove",h),v(s,"pointerup",F),v(s,"pointercancel",F));const A=()=>{z==null||z(),nt.update(l)};return{updateHandlers:C,end:A}},ht=(t,{onMove:e,onStart:n,onEnd:s,onSessionStart:r,onSessionEnd:a,threshold:c})=>{const f=!!e||!!n||!!s||!!r||!!a,o=m.useRef(null),i=Z({onSessionStart:r,onSessionEnd:a,onStart:n,onMove:e,onEnd:(u,l)=>{o.current=null,s==null||s(u,l)}});m.useEffect(()=>{var u;(u=o.current)==null||u.updateHandlers(i.current)}),m.useEffect(()=>{const u=t.current;return!u||!f?void 0:v(u,"pointerdown",h=>{o.current=at(h,i.current,c)})},[t,f,i,c]),m.useEffect(()=>()=>{var u;(u=o.current)==null||u.end(),o.current=null},[])},ft=(t,e)=>{if(!t){e(void 0);return}e({width:t.offsetWidth,height:t.offsetHeight});const n=t.ownerDocument.defaultView??window,s=new n.ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const[a]=r;let c,f;if("borderBoxSize"in a){const o=a.borderBoxSize,i=Array.isArray(o)?o[0]:o;c=i.inlineSize,f=i.blockSize}else c=t.offsetWidth,f=t.offsetHeight;e({width:c,height:f})});return s.observe(t,{box:"border-box"}),()=>s.unobserve(t)},lt=(t,e)=>{var r;if(!t||!t.parentElement)return;const n=((r=t.ownerDocument)==null?void 0:r.defaultView)??window,s=new n.MutationObserver(()=>{e()});return s.observe(t.parentElement,{childList:!0}),()=>{s.disconnect()}},pt=({getNodes:t,observeMutation:e=!0})=>{const[n,s]=m.useState([]),[r,a]=m.useState(0);return q(()=>{const c=t(),f=c.map((o,i)=>ft(o,u=>{s(l=>[...l.slice(0,i),u,...l.slice(i+1)])}));if(e){const o=c[0];f.push(lt(o,()=>{a(i=>i+1)}))}return()=>{f.forEach(o=>{o==null||o()})}},[r]),n},wt=t=>{const[e]=pt({observeMutation:!1,getNodes:()=>[B(t)?t.current:t]});return e};export{wt as a,ht as b,pt as c,Z as u};
//# sourceMappingURL=index-1c39cdb8.js.map

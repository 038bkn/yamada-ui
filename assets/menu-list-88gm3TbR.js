import{j as o}from"./jsx-runtime-X2b_N9AH.js";import{r as e}from"./index-uCp2LrAq.js";import{c as fe}from"./index-R6DR2XL8.js";import{u as me}from"./index-CFNUJ1Et.js";import{l as z,ab as Q,h as X,a as Y,f as Z,b as K,c as T,y as de,ae as xe,U as $,R as Ce}from"./factory-C0k1XOS4.js";import{a as P}from"./use-component-style-BxdeC6kK.js";import{o as ee}from"./theme-provider-DuMcMORV.js";import{u as be}from"./index-Bjd5vJC-.js";import{f as V}from"./forward-ref-Dr5Hqd9a.js";import{P as he,b as Ie}from"./popover-content-BM7mCRUg.js";const[pe,Re]=z({strict:!1,name:"ContextMenuContext"}),ze=c=>{const[r,l]=P("ContextMenu",c),{...u}=ee(l);return o.jsx(pe,{value:{styles:r},children:o.jsx(Oe,{trigger:"contextmenu",...u})})},[je,te]=z({strict:!1,name:"UpstreamMenuItemContext"}),ke=c=>{var r;return xe(c)&&!!((r=c==null?void 0:c.getAttribute("role"))!=null&&r.startsWith("menu-item"))},_e=V(({as:c,className:r,type:l,isDisabled:u,isFocusable:s,closeOnSelect:f,icon:b,command:p,children:m,onClick:h,onFocus:C,onMouseEnter:x,onMouseMove:I,onMouseLeave:R,onKeyDown:j,...n},D)=>{const{focusedIndex:k,setFocusedIndex:i,isOpen:M,onClose:F,onUpstreamClose:_,closeOnSelect:S,menuRef:y,requestAnimationFrameId:O,isNested:U,styles:q}=W(),{onUpstreamRestoreFocus:L}=te()??{},E=u&&!s,g=e.useRef(null),B=e.useRef(!1),A=e.useRef(()=>{}),{index:d,register:H}=De({disabled:E}),[v,a]=e.useState(!1),w=d===k,G=e.useCallback(t=>{x==null||x(t),!u&&i(d)},[i,d,u,x]),ne=e.useCallback(t=>{I==null||I(t),g.current&&!Q(g.current)&&G(t)},[G,I]),ce=e.useCallback(t=>{R==null||R(t),!u&&i(-1)},[i,u,R]),re=e.useCallback(t=>{if(h==null||h(t),!ke(t.currentTarget))return;const N=B.current;(f??(!N&&S))&&(F(),_==null||_())},[h,f,S,F,_]),ae=e.useCallback(t=>{C==null||C(t),i(d)},[C,i,d]),oe=e.useCallback(()=>{var t;(t=g.current)==null||t.focus(),i(d)},[i,d]),ue=e.useCallback(t=>{j==null||j(t);const J={ArrowLeft:U?$(L,F):void 0}[t.key];J&&(t.preventDefault(),t.stopPropagation(),J())},[j,L,F,U]),le=be({focusOnClick:!1,...n,onClick:re,onFocus:ae,onMouseEnter:G,onMouseMove:ne,onMouseLeave:ce,onKeyDown:X(ue,A.current),ref:Y(H,g,D),isDisabled:u,isFocusable:s});Z(()=>{if(!M)return;const t=O.current;return w&&!E&&g.current?(t&&cancelAnimationFrame(t),O.current=requestAnimationFrame(()=>{var N;(N=g.current)==null||N.focus({preventScroll:!0}),O.current=null})):y.current&&!Q(y.current)&&y.current.focus({preventScroll:!0}),()=>{t&&cancelAnimationFrame(t)}},[w,E,y,M]),l=c||l?l??void 0:"button",m=b||p?o.jsx(K.span,{style:{flex:1},children:m}):m;const ie={textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,gap:"0.75rem",...q.item};return o.jsx(je,{value:{onKeyDownRef:A,onUpstreamRestoreFocus:oe,setDownstreamOpen:a,hasDownstreamRef:B},children:o.jsxs(K.li,{...le,...v?{"data-active":""}:{},as:c,type:l,role:"menu-item",tabIndex:w?0:-1,className:T("ui-menu__item",r),__css:ie,children:[b?o.jsx(se,{children:b}):null,m,p?o.jsx(ye,{children:p}):null]})})}),We=V(({className:c,icon:r,isChecked:l,closeOnSelect:u=!1,children:s,...f},b)=>o.jsxs(_e,{ref:b,className:T("ui-menu__item--option",c),"aria-checked":de(l),closeOnSelect:u,...f,children:[r!==null?o.jsx(se,{opacity:l?1:0,children:r||o.jsx(we,{})}):null,s]})),se=V(({className:c,...r},l)=>{const{styles:u}=W(),s={flexShrink:0,display:"inline-flex",justifyContent:"center",alignItems:"center",fontSize:"0.85em",...u.icon};return o.jsx(K.span,{ref:l,className:T("ui-menu__item__icon",c),__css:s,...r})}),ye=V(({className:c,...r},l)=>{const{styles:u}=W(),s={...u.command};return o.jsx(K.span,{ref:l,className:T("ui-menu__item__command",c),__css:s,...r})}),we=()=>o.jsx("svg",{viewBox:"0 0 14 14",width:"1em",height:"1em",children:o.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),{DescendantsContextProvider:Me,useDescendantsContext:ge,useDescendants:ve,useDescendant:De}=fe(),[Fe,W]=z({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Se,Ae]=z({strict:!1,name:"UpstreamMenuContext"}),Oe=c=>{const{styles:r}=Re()??{},[l,u]=P("Menu",c,{isProcessSkip:!!r,styles:r});let{initialFocusRef:s,closeOnSelect:f=!0,closeOnBlur:b,placement:p,duration:m=.2,offset:h,onOpen:C,onClose:x,...I}=ee(u);const{relatedRef:R,onUpstreamClose:j,onDownstreamCloseMapRef:n}=Ae()??{},{setDownstreamOpen:D,hasDownstreamRef:k}=te()??{},i=!!R;i?(p??(p="right-start"),h??(h=[-8,8]),b??(b=!1)):p??(p="bottom-start");const M=ve(),[F,_]=e.useState(-1),S=e.useRef(null),y=e.useRef(new Set([])),O=e.useRef(null),U=e.useRef(new Map),q=e.useCallback(()=>{requestAnimationFrame(()=>{var a;return(a=S.current)==null?void 0:a.focus({preventScroll:!1})})},[]),L=e.useCallback(()=>{const a=setTimeout(()=>{if(s)return;const w=M.enabledFirstValue();w&&_(w.index)});y.current.add(a)},[M,s]),E=e.useCallback(()=>{const a=setTimeout(()=>{if(s)return;const w=M.enabledLastValue();w&&_(w.index)});y.current.add(a)},[M,s]),g=e.useCallback(()=>{C==null||C(),i||q()},[C,i,q]),B=e.useCallback(()=>{x==null||x();for(const a of U.current.values())a()},[x]),A=e.useId(),{isOpen:d,onOpen:H,onClose:v}=me({...c,onOpen:g,onClose:B});return e.useEffect(()=>{const a=n==null?void 0:n.current;return a==null||a.set(A,v),()=>{a==null||a.delete(A)}},[A,v,n]),e.useEffect(()=>{D&&D(d)},[D,d]),e.useEffect(()=>(k&&(k.current=!0),()=>{k&&(k.current=!1)})),Z(()=>{d||_(-1)},[d]),Ce(()=>{y.current.forEach(a=>clearTimeout(a)),y.current.clear()}),o.jsx(Me,{value:M,children:o.jsx(Se,{value:{relatedRef:S,onDownstreamCloseMapRef:U,onUpstreamClose:$(j,v)},children:o.jsx(Fe,{value:{isOpen:d,onOpen:H,onClose:v,onUpstreamClose:j,onFocusFirstItem:L,onFocusLastItem:E,closeOnSelect:f,focusedIndex:F,setFocusedIndex:_,menuRef:S,requestAnimationFrameId:O,isNested:i,styles:l},children:o.jsx(he,{trigger:i?"hover":"click",...I,isOpen:d,onOpen:H,onClose:v,placement:p,offset:h,duration:m,initialFocusRef:s,relatedRef:R,closeOnButton:!1,closeOnBlur:b})})})})},Ge=V(({className:c,...r},l)=>{const{menuRef:u,focusedIndex:s,setFocusedIndex:f,onClose:b,styles:p}=W(),m=ge(),h=e.useCallback(()=>{const n=m.enabledNextValue(s);n&&f(n.index)},[m,s,f]),C=e.useCallback(()=>{const n=m.enabledPrevValue(s);n&&f(n.index)},[m,s,f]),x=e.useCallback(()=>{const n=m.enabledFirstValue();n&&f(n.index)},[m,f]),I=e.useCallback(()=>{const n=m.enabledLastValue();n&&f(n.index)},[m,f]),R=e.useCallback(n=>{const k={Tab:i=>i.preventDefault(),Escape:b,ArrowDown:s===-1?x:h,ArrowUp:s===-1?I:C,Home:x,End:I}[n.key];k&&(n.preventDefault(),k(n))},[s,b,x,I,h,C]),j={...p.list};return o.jsx(Ie,{as:"ul",ref:Y(u,l),className:T("ui-menu__list",c),role:"menu",tabIndex:-1,__css:j,...r,onKeyDown:X(r.onKeyDown,R)})});export{ze as C,se as M,W as a,Oe as b,Ge as c,_e as d,Re as e,We as f,te as u};
